import{q as N,g as i,M as T,N as U,u as B,m as E,w as O,O as m,h as l}from"./main-BW0ZwJr4.js";import{c as R,a as Y}from"./date-Bar67dSB.js";const q=N("appointments",()=>{const o=i(""),s=i([]),r=i(""),u=i(""),v=i([]),d=i([]),c=T("toast"),S=U(),g=B();E(()=>{for(let a=8;a<=21;a++)d.value.push(`${a}:30`),a<21&&d.value.push(`${a}:59`)}),O(r,async()=>{var t;if(u.value="",r.value==="")return;const{data:e}=await m.getByDate(r.value);o.value?(v.value=e.filter(a=>a._id!==o.value),u.value=((t=e.filter(a=>a._id===o.value)[0])==null?void 0:t.time)||""):v.value=e});function A(e){s.value=e.services,r.value=R(e.date),u.value=e.time,o.value=e._id}function _(e){if(s.value.some(t=>t._id===e._id))s.value=s.value.filter(t=>t._id!==e._id);else{if(s.value.length===2){alert("Máximo 2 servicios");return}s.value.push(e)}}async function w(){var t,a,f,p;const e={services:s.value.map(n=>n._id),date:Y(r.value),time:u.value,totalAmount:y.value};if(o.value)try{const{data:n}=await m.update(o.value,e);c.open({message:n.msg,type:"success"})}catch(n){c.open({message:((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.msg)||"Error al actualizar la cita",type:"error"})}else try{const{data:n}=await m.create(e);c.open({message:n.msg||"Cita creada exitosamente",type:"success"})}catch(n){c.open({message:((p=(f=n.response)==null?void 0:f.data)==null?void 0:p.msg)||"Error al crear la cita",type:"error"})}h(),g.getUserAppointments(),S.push({name:"my_appointments"})}function h(){o.value="",s.value=[],r.value="",u.value=""}async function D(e){if(confirm("¿Deseas cancelar esta cita?"))try{const{data:t}=await m.delete(e);c.open({message:t.msg,type:"success"}),g.getUserAppointments()}catch(t){c.open({message:t.response.data.msg,type:"error"})}}const H=l(()=>e=>s.value.some(t=>t._id===e)),M=l(()=>s.value.length===0),y=l(()=>s.value.reduce((e,t)=>e+t.price,0)),I=l(()=>s.value.length&&r.value.length&&u.value.length),b=l(()=>!!r.value),x=l(()=>{const t=new Date().getHours();return a=>parseInt(a.split(":")[0],10)<t?!0:v.value.some(p=>p.time===a)});return{services:s,date:r,hours:d,time:u,setSelectedAppointment:A,onServiceSelected:_,saveAppointment:w,clearAppoinmentData:h,cancelAppointment:D,isServiceSelected:H,noServiceSelected:M,totalAmount:y,isValidReservation:I,isDateSelected:b,disableTime:x}});export{q as u};
