import{B as D,U as H,e as o,j as U,W as P,V as g,f as v,Q as R,w as V}from"./main-D-xxpp6D.js";import{c as Y,a as $}from"./date-Bar67dSB.js";const w=D("user",()=>{const p=H(),n=o({}),m=o([]),a=o(!0);U(async()=>{try{const{data:u}=await P.auth();n.value=u,await r()}catch(u){console.log(u)}finally{a.value=!1}});async function r(){const{data:u}=await g.getUserAppointments1(n.value._id);m.value=u}const l=()=>{localStorage.removeItem("AUTH_TOKEN"),n.value={},p.push({name:"home"})},d=v(()=>{var u,i;return(u=n.value)!=null&&u.name?(i=n.value)==null?void 0:i.name:""}),h=v(()=>m.value.length==0);return{user:n,getUserAppointments1:r,userAppointments,loading:a,logout:l,getUserName:d,noAppointments1:h}}),Q=D("appointments",()=>{const p=o(""),n=o(""),m=o(""),a=o([]),r=o(""),l=o(""),d=o([]),h=o([]),u=o([]),i=R("toast"),b=H(),A=w();w(),U(()=>{for(let s=8;s<=21;s++)h.value.push(`${s}:30`),s<21&&h.value.push(`${s}:59`)}),V(r,async()=>{var e;if(l.value="",r.value!=="")try{const{data:t}=await g.getByDate2(r.value,p.value);n.value?(d.value=t.filter(s=>s._id!==n.value),l.value=((e=t.filter(s=>s._id===n.value)[0])==null?void 0:e.time)||""):d.value=t}catch(t){console.error("Error fetching appointments:",t)}});function B(e){a.value=e.services,r.value=Y(e.date),l.value=e.time,p.value=e.selectedBarber,m.value=e.phonecita,n.value=e._id,u.value=e.vouchers||[]}function I(e){if(a.value.some(t=>t._id===e._id))a.value=a.value.filter(t=>t._id!==e._id);else{if(a.value.length===4){alert("Máximo 4 servicios");return}a.value.push(e)}}async function T(){var t,s,y,f;const e={services:a.value.map(c=>c._id),date:$(r.value),time:l.value,totalAmount:_.value,selectedBarber:p.value,phonecita:m.value,vouchers:u.value.map(c=>c._id)};if(n.value)try{const{data:c}=await g.update(n.value,e);i.open({message:c.msg,type:"success"})}catch(c){i.open({message:((s=(t=c.response)==null?void 0:t.data)==null?void 0:s.msg)||"Error al actualizar la cita",type:"error"})}else try{const{data:c}=await g.create(e);i.open({message:c.msg||"Cita creada exitosamente",type:"success"})}catch(c){i.open({message:((f=(y=c.response)==null?void 0:y.data)==null?void 0:f.msg)||"Error al crear la cita",type:"error"})}S(),A.getUserAppointments1(),b.push({name:"my_appointments"})}function E(e){p.value=e,a.value=[],r.value="",l.value=""}function S(){n.value="",a.value=[],r.value="",l.value=""}async function M(e){if(confirm("¿Deseas cancelar esta cita?"))try{const{data:t}=await g.delete(e);i.open({message:t.msg,type:"success"}),A.getUserAppointments1()}catch(t){i.open({message:t.response.data.msg,type:"error"})}}const N=v(()=>e=>a.value.some(t=>t._id===e)),x=v(()=>a.value.length===0),_=v(()=>a.value.reduce((e,t)=>e+t.price,0)),j=v(()=>a.value.length&&r.value.length&&l.value.length),C=v(()=>!!r.value),O=v(()=>{const t=new Date().getHours();return s=>parseInt(s.split(":")[0],10)<t?!0:d.value.some(f=>f.time===s)});return{selectedBarber:p,handleBarberChange:E,services:a,date:r,hours:h,time:l,setSelectedAppointment:B,onServiceSelected:I,saveAppointment:T,clearAppoinmentData:S,cancelAppointment:M,isServiceSelected:N,noServiceSelected:x,totalAmount:_,isValidReservation:j,isDateSelected:C,disableTime:O}});export{w as a,Q as u};
